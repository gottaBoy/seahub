{"version":3,"file":"static/js/viewFileSdoc.6adf9d14.js","mappings":"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","sources":["pages/sdoc/sdoc-editor/external-operations.js","pages/sdoc/sdoc-editor/index.js","view-file-sdoc.js"],"sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport { EventBus, EXTERNAL_EVENT } from '@seafile/sdoc-editor';\nimport { seafileAPI } from '../../../utils/seafile-api';\nimport { Utils } from '../../../utils/utils';\nimport toaster from '../../../components/toast';\nimport InternalLinkDialog from '../../../components/dialog/internal-link-dialog';\nimport ShareDialog from '../../../components/dialog/share-dialog';\n\nconst propTypes = {\n  repoID: PropTypes.string.isRequired,\n  docPath: PropTypes.string.isRequired,\n  docName: PropTypes.string.isRequired,\n  docPerm: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  toggleStar: PropTypes.func.isRequired,\n  unmarkDraft: PropTypes.func.isRequired\n};\n\nclass ExternalOperations extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowInternalLinkDialog: false,\n      isShowShareDialog: false,\n    };\n  }\n\n  componentDidMount() {\n    const eventBus = EventBus.getInstance();\n    this.unsubscribeInternalLinkEvent = eventBus.subscribe(EXTERNAL_EVENT.INTERNAL_LINK_CLICK, this.onInternalLinkToggle);\n    this.unsubscribeStar = eventBus.subscribe(EXTERNAL_EVENT.TOGGLE_STAR, this.toggleStar);\n    this.unsubscribeUnmark = eventBus.subscribe(EXTERNAL_EVENT.UNMARK_AS_DRAFT, this.unmark);\n    this.unsubscribeShare = eventBus.subscribe(EXTERNAL_EVENT.SHARE_SDOC, this.onShareToggle);\n    this.unsubscribeShare = eventBus.subscribe(EXTERNAL_EVENT.FREEZE_DOCUMENT, this.onFreezeDocument);\n    this.unsubscribeShare = eventBus.subscribe(EXTERNAL_EVENT.UNFREEZE, this.unFreeze);\n  }\n\n  componentWillUnmount() {\n    this.unsubscribeInternalLinkEvent();\n    this.unsubscribeStar();\n    this.unsubscribeUnmark();\n    this.unsubscribeShare();\n  }\n\n  onInternalLinkToggle = () => {\n    this.setState({isShowInternalLinkDialog: !this.state.isShowInternalLinkDialog});\n  };\n\n  unmark = () => {\n    const { repoID, docPath } = this.props;\n    seafileAPI.sdocUnmarkAsDraft(repoID, docPath).then((res) => {\n      this.props.unmarkDraft();\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  toggleStar = () => {\n    const { isStarred, repoID, docPath  } = this.props;\n    if (isStarred) {\n      seafileAPI.unstarItem(repoID, docPath).then((res) => {\n        this.props.toggleStar(false);\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    } else {\n      seafileAPI.starItem(repoID, docPath).then((res) => {\n        this.props.toggleStar(true);\n      }).catch((error) => {\n        const errorMsg = Utils.getErrorMsg(error);\n        toaster.danger(errorMsg);\n      });\n    }\n  };\n\n  onShareToggle = () => {\n    this.setState({isShowShareDialog: !this.state.isShowShareDialog});\n  };\n\n  onFreezeDocument = () => {\n    const { repoID, docPath } = this.props;\n    seafileAPI.lockfile(repoID, docPath, -1).then((res) => {\n      const eventBus = EventBus.getInstance();\n      eventBus.dispatch(EXTERNAL_EVENT.REFRESH_DOCUMENT);\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  unFreeze = () => {\n    const { repoID, docPath } = this.props;\n    seafileAPI.unlockfile(repoID, docPath).then((res) => {\n      const eventBus = EventBus.getInstance();\n      eventBus.dispatch(EXTERNAL_EVENT.REFRESH_DOCUMENT);\n    }).catch(error => {\n      let errMessage = Utils.getErrorMsg(error);\n      toaster.danger(errMessage);\n    });\n  };\n\n  render() {\n    const { repoID, docPath, docName, docPerm } = this.props;\n    const { isShowInternalLinkDialog, isShowShareDialog } = this.state;\n    return (\n      <>\n        {isShowInternalLinkDialog && (\n          <InternalLinkDialog\n            repoID={repoID}\n            path={docPath}\n            onInternalLinkDialogToggle={this.onInternalLinkToggle}\n          />\n        )}\n        {isShowShareDialog && (\n          <ShareDialog\n            itemType={'file'}\n            itemPath={docPath}\n            itemName={docName}\n            repoID={repoID}\n            userPerm={docPerm}\n            toggleDialog={this.onShareToggle}\n          />\n        )}\n      </>\n    );\n  }\n}\n\nExternalOperations.propTypes = propTypes;\n\nexport default ExternalOperations;\n","import React, { Fragment } from 'react';\nimport { SimpleEditor } from '@seafile/sdoc-editor';\nimport ExternalOperations from './external-operations';\nimport { Utils } from '../../../utils/utils';\n\nexport default class SdocEditor extends React.Component {\n\n  constructor(props) {\n    super(props);\n    const { isStarred, isSdocDraft } = window.app.pageOptions;\n    this.state = {\n      isStarred: isStarred,\n      isDraft: isSdocDraft\n    };\n  }\n\n  componentDidMount() {\n    const { docName } = window.seafile;\n    const fileIcon = Utils.getFileIconUrl(docName, 192);\n    document.getElementById('favicon').href = fileIcon;\n  }\n\n  toggleStar = (isStarred) => {\n    this.setState({isStarred: isStarred});\n  };\n\n  unmarkDraft = () => {\n    this.setState({isDraft: false});\n  };\n\n  render() {\n    const { repoID, docPath, docName, docPerm } = window.seafile;\n    const { isStarred, isDraft } = this.state;\n    return (\n      <Fragment>\n        <SimpleEditor isStarred={isStarred} isDraft={isDraft} />\n        <ExternalOperations\n          repoID={repoID}\n          docPath={docPath}\n          docName={docName}\n          docPerm={docPerm}\n          isStarred={isStarred}\n          toggleStar={this.toggleStar}\n          unmarkDraft={this.unmarkDraft}\n        />\n      </Fragment>\n    );\n  }\n}\n","import React, { Suspense } from 'react';\nimport ReactDom from 'react-dom';\nimport { I18nextProvider } from 'react-i18next';\nimport i18n from './_i18n/i18n-sdoc-editor';\nimport { Utils } from './utils/utils';\nimport Loading from './components/loading';\nimport SdocEditor from './pages/sdoc/sdoc-editor';\n\nconst { serviceURL, avatarURL, siteRoot, lang, mediaUrl, isPro } = window.app.config;\nconst { username, name } = window.app.userInfo;\nconst {\n  repoID, repoName, parentDir, filePerm,\n  docPath, docName, docUuid, seadocAccessToken, seadocServerUrl, assetsUrl,\n  isSdocRevision, isPublished, originFilename, revisionCreatedAt, originFileVersion,\n  originFilePath, originDocUuid, revisionId, isFreezed\n} = window.app.pageOptions;\n\nwindow.seafile = {\n  repoID,\n  docPath,\n  docName,\n  docUuid,\n  isOpenSocket: true,\n  serviceUrl: serviceURL,\n  accessToken: seadocAccessToken,\n  sdocServer: seadocServerUrl,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  docPerm: filePerm,\n  historyURL: Utils.generateHistoryURL(siteRoot, repoID, docPath),\n  parentFolderURL: `${siteRoot}library/${repoID}/${Utils.encodePath(repoName + parentDir)}`,\n  assetsUrl,\n  isShowInternalLink: true,\n  isStarIconShown: true, // for star/unstar\n  isSdocRevision,\n  isPublished,\n  originFilename,\n  originFileVersion,\n  originFilePath,\n  originDocUuid,\n  revisionCreatedAt,\n  lang,\n  revisionId,\n  mediaUrl,\n  isFreezed,\n  isPro: isPro === 'True' ? true : false,\n};\n\nReactDom.render(\n  <I18nextProvider i18n={ i18n } >\n    <Suspense fallback={<Loading />}>\n      <SdocEditor />\n    </Suspense>\n  </I18nextProvider>,\n  document.getElementById('wrapper')\n);\n"],"names":["ExternalOperations","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","onInternalLinkToggle","setState","isShowInternalLinkDialog","state","unmark","_this$props","repoID","docPath","seafileAPI","sdocUnmarkAsDraft","then","res","unmarkDraft","catch","error","errMessage","Utils","getErrorMsg","toaster","danger","toggleStar","_this$props2","isStarred","unstarItem","errorMsg","starItem","onShareToggle","isShowShareDialog","onFreezeDocument","_this$props3","lockfile","EventBus","getInstance","dispatch","EXTERNAL_EVENT","REFRESH_DOCUMENT","unFreeze","_this$props4","unlockfile","_createClass","key","value","eventBus","this","unsubscribeInternalLinkEvent","subscribe","INTERNAL_LINK_CLICK","unsubscribeStar","TOGGLE_STAR","unsubscribeUnmark","UNMARK_AS_DRAFT","unsubscribeShare","SHARE_SDOC","FREEZE_DOCUMENT","UNFREEZE","_this$props5","docName","docPerm","_this$state","_jsxs","_Fragment","children","_jsx","InternalLinkDialog","path","onInternalLinkDialogToggle","ShareDialog","itemType","itemPath","itemName","userPerm","toggleDialog","React","SdocEditor","isDraft","_window$app$pageOptio","window","app","pageOptions","isSdocDraft","seafile","fileIcon","getFileIconUrl","document","getElementById","href","_window$seafile","Fragment","SimpleEditor","_window$app$config","config","serviceURL","avatarURL","siteRoot","lang","mediaUrl","isPro","_window$app$userInfo","userInfo","username","name","repoName","parentDir","filePerm","docUuid","seadocAccessToken","seadocServerUrl","assetsUrl","isSdocRevision","isPublished","originFilename","revisionCreatedAt","originFileVersion","originFilePath","originDocUuid","revisionId","isFreezed","isOpenSocket","serviceUrl","accessToken","sdocServer","historyURL","generateHistoryURL","parentFolderURL","concat","encodePath","isShowInternalLink","isStarIconShown","ReactDom","I18nextProvider","i18n","Suspense","fallback","Loading"],"sourceRoot":""}