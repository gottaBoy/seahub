{"version":3,"file":"static/js/sharedFileViewDocument.180f58d8.js","mappings":"sRAWAA,EAGIC,OAAOC,OAAOC,YAFhBC,EAAMJ,EAANI,OAAQC,EAAQL,EAARK,SAAUC,EAAGN,EAAHM,IAClBC,EAAQP,EAARO,SAAUC,EAAQR,EAARQ,SAAUC,EAAWT,EAAXS,YAGhBC,EAAsB,SAAAC,IAAAC,EAAAA,EAAAA,GAAAF,EAAAC,GAAA,IAAAE,GAAAC,EAAAA,EAAAA,GAAAJ,GAAA,SAAAA,IAAA,OAAAK,EAAAA,EAAAA,GAAA,KAAAL,GAAAG,EAAAG,MAAA,KAAAC,UAAA,CAGzB,OAHyBC,EAAAA,EAAAA,GAAAR,EAAA,EAAAS,IAAA,SAAAC,MAC1B,WACE,OAAOC,EAAAA,EAAAA,KAACC,EAAAA,EAAc,CAACC,SAASF,EAAAA,EAAAA,KAACG,EAAW,KAC9C,KAACd,CAAA,CAHyB,CAASe,EAAAA,WAM/BD,EAAW,SAAAE,IAAAd,EAAAA,EAAAA,GAAAY,EAAAE,GAAA,IAAAC,GAAAb,EAAAA,EAAAA,GAAAU,GAEf,SAAAA,EAAYI,GAAQ,IAADC,EAKf,OALed,EAAAA,EAAAA,GAAA,KAAAS,IACjBK,EAAAF,EAAAG,KAAA,KAAMF,IACDG,MAAQ,CACXC,WAAY1B,EACZ2B,SAAU,IACVJ,CACJ,CAwEC,OAxEAX,EAAAA,EAAAA,GAAAM,EAAA,EAAAL,IAAA,oBAAAC,MAED,WAAqB,IAADc,EAAA,KAClB,IAAI5B,EAAJ,EAIkB,SAAd6B,IACFC,EAAAA,EAAWC,6BAA6BjC,EAAQG,EAAUF,EAAUG,EAAS8B,cAAe7B,GAAa8B,MAAK,SAACC,GAE7G,OADsBA,EAAIC,KAAa,QAErC,IAAK,aACHP,EAAKQ,SAAS,CACZV,WAAW,IAEbW,WAAWR,EAAa,KACxB,MACF,IAAK,QACHD,EAAKQ,SAAS,CACZV,WAAW,EACXC,UAAUW,EAAAA,EAAAA,IAAQ,iCAEpB,MACF,IAAK,OACHV,EAAKQ,SAAS,CACZV,WAAW,EACXC,SAAU,KAGZ,IAAIY,EAAaC,SAASC,cAAc,UACxCF,EAAWG,KAAO,kBAClBH,EAAWI,IAAG,GAAAC,OAAMC,EAAAA,GAAQ,wBAC5BL,SAASM,KAAKC,OAAOR,GAE3B,IAAGS,OAAM,SAACC,GACJA,EAAMC,SACRtB,EAAKQ,SAAS,CACZV,WAAW,EACXC,UAAUW,EAAAA,EAAAA,IAAQ,iCAGpBV,EAAKQ,SAAS,CACZV,WAAW,EACXC,UAAUW,EAAAA,EAAAA,IAAQ,8BAGxB,GACF,CAEAT,EA5CA,CA6CF,GAAC,CAAAhB,IAAA,SAAAC,MAED,WACE,IAAAqC,EAAgCC,KAAK3B,MAA7BC,EAASyB,EAATzB,UAAWC,EAAQwB,EAARxB,SAEnB,OAAI3B,GACKe,EAAAA,EAAAA,KAACsC,EAAAA,EAAiB,IAGvB3B,GACKX,EAAAA,EAAAA,KAACuC,EAAAA,EAAO,IAGb3B,GACKZ,EAAAA,EAAAA,KAACsC,EAAAA,EAAiB,CAAC1B,SAAUA,KAIpCZ,EAAAA,EAAAA,KAAA,OAAKwC,UAAU,sCAAqCC,UAClDzC,EAAAA,EAAAA,KAAC0C,EAAAA,EAAS,KAGhB,KAACvC,CAAA,CAhFc,CAASC,EAAAA,WAmF1BuC,EAAAA,QAAgB3C,EAAAA,EAAAA,KAACX,EAAsB,IAAKoC,SAASmB,eAAe,W","sources":["shared-file-view-document.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport { seafileAPI } from './utils/seafile-api';\nimport { gettext, mediaUrl} from './utils/constants';\nimport SharedFileView from './components/shared-file-view/shared-file-view';\nimport SharedFileViewTip from './components/shared-file-view/shared-file-view-tip';\nimport Loading from './components/loading';\nimport PDFViewer from './components/pdf-viewer';\n\nimport './css/pdf-file-view.css';\n\nconst {\n  repoID, filePath, err,\n  commitID, fileType, sharedToken\n} = window.shared.pageOptions;\n\nclass SharedFileViewDocument extends React.Component {\n  render() {\n    return <SharedFileView content={<FileContent />} />;\n  }\n}\n\nclass FileContent extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: !err,\n      errorMsg: ''\n    };\n  }\n\n  componentDidMount() {\n    if (err) {\n      return;\n    }\n\n    let queryStatus = () => {\n      seafileAPI.queryOfficeFileConvertStatus(repoID, commitID, filePath, fileType.toLowerCase(), sharedToken).then((res) => {\n        const convertStatus = res.data['status'];\n        switch (convertStatus) {\n          case 'PROCESSING':\n            this.setState({\n              isLoading: true\n            });\n            setTimeout(queryStatus, 2000);\n            break;\n          case 'ERROR':\n            this.setState({\n              isLoading: false,\n              errorMsg: gettext('Document convertion failed.')\n            });\n            break;\n          case 'DONE':\n            this.setState({\n              isLoading: false,\n              errorMsg: ''\n            });\n            // eslint-disable-next-line\n            let scriptNode = document.createElement('script');\n            scriptNode.type = 'text/javascript';\n            scriptNode.src = `${mediaUrl}js/pdf/web/viewer.js`;\n            document.body.append(scriptNode);\n        }\n      }).catch((error) => {\n        if (error.response) {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Document convertion failed.')\n          });\n        } else {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Please check the network.')\n          });\n        }\n      });\n    };\n\n    queryStatus();\n  }\n\n  render() {\n    const { isLoading, errorMsg } = this.state;\n\n    if (err) {\n      return <SharedFileViewTip />;\n    }\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <SharedFileViewTip errorMsg={errorMsg} />;\n    }\n\n    return (\n      <div className=\"shared-file-view-body pdf-file-view\">\n        <PDFViewer />\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SharedFileViewDocument />, document.getElementById('wrapper'));\n"],"names":["_window$shared$pageOp","window","shared","pageOptions","repoID","filePath","err","commitID","fileType","sharedToken","SharedFileViewDocument","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","_jsx","SharedFileView","content","FileContent","React","_React$Component2","_super2","props","_this","call","state","isLoading","errorMsg","_this2","queryStatus","seafileAPI","queryOfficeFileConvertStatus","toLowerCase","then","res","data","setState","setTimeout","gettext","scriptNode","document","createElement","type","src","concat","mediaUrl","body","append","catch","error","response","_this$state","this","SharedFileViewTip","Loading","className","children","PDFViewer","ReactDom","getElementById"],"sourceRoot":""}