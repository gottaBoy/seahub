{"version":3,"file":"static/js/fileHistoryOld.8289da31.js","mappings":"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","sources":["pages/file-history-old/history-item.js","file-history-old.js"],"sourcesContent":["import React, { Fragment } from 'react';\nimport PropTypes from 'prop-types';\nimport moment from 'moment';\nimport { Utils } from '../../utils/utils';\nimport { gettext, siteRoot, filePath, historyRepoID } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem } from 'reactstrap';\n\nmoment.locale(window.app.config.lang);\n\nconst propTypes = {\n  item: PropTypes.object.isRequired,\n  index: PropTypes.number.isRequired,\n  canDownload: PropTypes.bool.isRequired,\n  canCompare: PropTypes.bool.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n  snapshotURL: PropTypes.string.isRequired,\n};\n\nclass HistoryItem extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      active: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    this.setState({\n      active: true\n    });\n  };\n\n  onMouseLeave = () => {\n    this.setState({\n      active: false\n    });\n  };\n\n  onItemRestore = (e) => {\n    e.preventDefault();\n    this.props.onItemRestore(this.props.item);\n  };\n\n  render() {\n    let item = this.props.item;\n    let downloadUrl = URLDecorator.getUrl({type: 'download_historic_file', filePath: filePath, objID: item.rev_file_id});\n    let userProfileURL = `${siteRoot}profile/${encodeURIComponent(item.creator_email)}/`;\n    let viewUrl = `${siteRoot}repo/${historyRepoID}/history/files/?obj_id=${item.rev_file_id}&commit_id=${item.commit_id}&p=${Utils.encodePath(filePath)}`;\n    let diffUrl = `${siteRoot}repo/text_diff/${historyRepoID}/?commit=${item.commit_id}&p=${Utils.encodePath(filePath)}`;\n    const snapshotURL = `${siteRoot}repo/${historyRepoID}/snapshot/?commit_id=${item.commit_id}`;\n    return (\n      <Fragment>\n        <tr onMouseEnter={this.onMouseEnter} onMouseLeave={this.onMouseLeave} className={this.state.active ? 'tr-highlight' : ''}>\n          <td>\n            <span>{moment(item.ctime).format('YYYY-MM-DD HH:mm:ss')}</span>\n            {this.props.index === 0 && <span className=\"ml-1\">{gettext('(current version)')}</span>}\n          </td>\n          <td>\n            <img className=\"avatar\" src={item.creator_avatar_url} alt=''></img>{' '}\n            <a href={userProfileURL} target='_blank' className=\"username\" rel=\"noreferrer\">{item.creator_name}</a>\n          </td>\n          <td>{Utils.bytesToSize(item.size)}</td>\n          <td>\n            {this.state.active &&\n              <MoreMenu\n                index={this.props.index}\n                downloadUrl={downloadUrl}\n                viewUrl={viewUrl}\n                diffUrl={diffUrl}\n                snapshotURL={snapshotURL}\n                onItemRestore={this.onItemRestore}\n                canDownload={this.props.canDownload}\n                canCompare={this.props.canCompare}\n              />\n            }\n          </td>\n        </tr>\n      </Fragment>\n    );\n  }\n}\n\nHistoryItem.propTypes = propTypes;\n\n\nconst MoreMenuPropTypes = {\n  index: PropTypes.number.isRequired,\n  downloadUrl: PropTypes.string.isRequired,\n  viewUrl: PropTypes.string.isRequired,\n  diffUrl: PropTypes.string.isRequired,\n  onItemRestore: PropTypes.func.isRequired,\n  canDownload: PropTypes.bool.isRequired,\n  canCompare: PropTypes.bool.isRequired,\n  snapshotURL: PropTypes.string.isRequired,\n};\n\nclass MoreMenu extends React.PureComponent {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      dropdownOpen: false\n    };\n  }\n\n  dropdownToggle = () => {\n    this.setState({ dropdownOpen: !this.state.dropdownOpen });\n  };\n\n  render() {\n    const { index, downloadUrl, viewUrl, snapshotURL, onItemRestore, canDownload } = this.props;\n    return (\n      <Dropdown isOpen={this.state.dropdownOpen} toggle={this.dropdownToggle} direction=\"down\" className=\"mx-1 old-history-more-operation\">\n        <DropdownToggle\n          tag='i'\n          className='fa fa-ellipsis-v'\n          title={gettext('More Operations')}\n          data-toggle=\"dropdown\"\n          aria-expanded={this.state.dropdownOpen}\n        >\n        </DropdownToggle>\n        <DropdownMenu className=\"drop-list\" right={true}>\n          {index !== 0 && <a href=\"#\" onClick={onItemRestore}><DropdownItem>{gettext('Restore')}</DropdownItem></a>}\n          {canDownload && <a href={downloadUrl}><DropdownItem>{gettext('Download')}</DropdownItem></a>}\n          <a href={viewUrl}><DropdownItem>{gettext('View')}</DropdownItem></a>\n          {/*canCompare && <a href={diffUrl}><DropdownItem>{gettext('Diff')}</DropdownItem></a>*/}\n          {index != 0 && <DropdownItem tag=\"a\" href={snapshotURL} target=\"_blank\">{gettext('View Related Snapshot')}</DropdownItem>}\n        </DropdownMenu>\n      </Dropdown>\n    );\n  }\n}\n\nMoreMenu.propTypes = MoreMenuPropTypes;\n\nexport default HistoryItem;\n","import React, { Fragment } from 'react';\nimport ReactDom from 'react-dom';\nimport { Button } from 'reactstrap';\nimport { Utils } from './utils/utils';\nimport { seafileAPI } from './utils/seafile-api';\nimport { gettext, PER_PAGE, filePath, fileName, historyRepoID, useNewAPI, canDownload, canCompare } from './utils/constants';\nimport editUtilities from './utils/editor-utilities';\nimport Loading from './components/loading';\nimport Logo from './components/logo';\nimport CommonToolbar from './components/toolbar/common-toolbar';\nimport HistoryItem from './pages/file-history-old/history-item';\n\nimport './css/layout.css';\nimport './css/toolbar.css';\nimport './css/search.css';\nimport './css/file-history-old.css';\n\nclass FileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      historyList: [],\n      currentPage: 1,\n      hasMore: false,\n      nextCommit: undefined,\n      filePath: '',\n      oldFilePath: '',\n      isLoading: true,\n      isReloadingData: false,\n    };\n  }\n\n  componentDidMount() {\n    if (useNewAPI) {\n      this.listNewHistoryRecords(filePath, PER_PAGE);\n    } else {\n      this.listOldHistoryRecords(historyRepoID, filePath);\n    }\n  }\n\n  listNewHistoryRecords = (filePath, PER_PAGE) => {\n    editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then(res => {\n      let historyData = res.data;\n      if (!historyData) {\n        this.setState({isLoading: false});\n        throw Error('There is an error in server.');\n      }\n      this.initNewRecords(res.data);\n    });\n  };\n\n  listOldHistoryRecords = (repoID, filePath) => {\n    seafileAPI.listOldFileHistoryRecords(repoID, filePath).then((res) => {\n      let historyData = res.data;\n      if (!historyData) {\n        this.setState({isLoading: false});\n        throw Error('There is an error in server.');\n      }\n      this.initOldRecords(res.data);\n    });\n  };\n\n  initNewRecords(result) {\n    if (result.total_count < 5) {\n      if (result.data.length) {\n        let commitID = result.data[result.data.length-1].commit_id;\n        let path = result.data[result.data.length-1].path;\n        let oldPath = result.data[result.data.length-1].old_path;\n        path = oldPath ? oldPath : path;\n        seafileAPI.listOldFileHistoryRecords(historyRepoID, path, commitID).then((res) => {\n          if (!res.data) {\n            this.setState({isLoading: false});\n            throw Error('There is an error in server.');\n          }\n          this.setState({\n            historyList: result.data.concat(res.data.data.slice(1, res.data.data.length)),\n            isLoading: false,\n          });\n        });\n      } else {\n        seafileAPI.listOldFileHistoryRecords(historyRepoID, filePath).then((res) => {\n          if (!res.data) {\n            this.setState({isLoading: false});\n            throw Error('There is an error in server.');\n          }\n          this.setState({\n            historyList: res.data.data,\n            isLoading: false,\n          });\n        });\n      }\n    } else {\n      this.setState({\n        historyList: result.data,\n        currentPage: result.page,\n        hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n        isLoading: false,\n      });\n    }\n  }\n\n  initOldRecords(result) {\n    if (result.data.length) {\n      this.setState({\n        historyList: result.data,\n        nextCommit: result.next_start_commit,\n        filePath: result.data[result.data.length-1].path,\n        oldFilePath: result.data[result.data.length-1].rev_renamed_old_path,\n        isLoading: false,\n      });\n    } else {\n      this.setState({nextCommit: result.next_start_commit,});\n      if (this.state.nextCommit) {\n        seafileAPI.listOldFileHistoryRecords(historyRepoID, filePath, this.state.nextCommit).then((res) => {\n          this.initOldRecords(res.data);\n        });\n      } else {\n        this.setState({isLoading: false});\n      }\n    }\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    let hasMore = this.state.hasMore;\n    if (isBottom && hasMore) {\n      this.reloadMore();\n    }\n  };\n\n  reloadMore = () => {\n    if (!this.state.isReloadingData) {\n      if (useNewAPI) {\n        let currentPage = this.state.currentPage + 1;\n        this.setState({\n          currentPage: currentPage,\n          isReloadingData: true,\n        });\n        editUtilities.listFileHistoryRecords(filePath, currentPage, PER_PAGE).then(res => {\n          this.updateNewRecords(res.data);\n        });\n      } else {\n        let commitID = this.state.nextCommit;\n        let filePath = this.state.filePath;\n        let oldFilePath = this.state.oldFilePath;\n        this.setState({isReloadingData: true});\n        if (oldFilePath) {\n          seafileAPI.listOldFileHistoryRecords(historyRepoID, oldFilePath, commitID).then((res) => {\n            this.updateOldRecords(res.data, oldFilePath);\n          });\n        } else {\n          seafileAPI.listOldFileHistoryRecords(historyRepoID, filePath, commitID).then((res) => {\n            this.updateOldRecords(res.data, filePath);\n          });\n        }\n      }\n    }\n  };\n\n  updateNewRecords(result) {\n    this.setState({\n      historyList: [...this.state.historyList, ...result.data],\n      currentPage: result.page,\n      hasMore: result.total_count > (PER_PAGE * this.state.currentPage),\n      isReloadingData: false,\n    });\n  }\n\n  updateOldRecords(result, filePath) {\n    if (result.data.length) {\n      this.setState({\n        historyList: [...this.state.historyList, ...result.data],\n        nextCommit: result.next_start_commit,\n        filePath: result.data[result.data.length-1].path,\n        oldFilePath: result.data[result.data.length-1].rev_renamed_old_path,\n        isReloadingData: false,\n      });\n    } else {\n      this.setState({nextCommit: result.next_start_commit,});\n      if (this.state.nextCommit) {\n        seafileAPI.listOldFileHistoryRecords(historyRepoID, filePath, this.state.nextCommit).then((res) => {\n          this.updateOldRecords(res.data, filePath);\n        });\n      }\n    }\n  }\n\n  onItemRestore = (item) => {\n    let commitId = item.commit_id;\n    let filePath = item.path;\n    editUtilities.revertFile(filePath, commitId).then(res => {\n      if (res.data.success) {\n        this.setState({isLoading: true});\n        this.refershFileList();\n      }\n    });\n  };\n\n  refershFileList() {\n    if (useNewAPI) {\n      editUtilities.listFileHistoryRecords(filePath, 1, PER_PAGE).then((res) => {\n        this.initNewRecords(res.data);\n      });\n    } else {\n      seafileAPI.listOldFileHistoryRecords(historyRepoID, filePath).then((res) => {\n        this.initOldRecords(res.data);\n      });\n    }\n  }\n\n  onSearchedClick = (searchedItem) => {\n    Utils.handleSearchedItemClick(searchedItem);\n  };\n\n  goBack = (e) => {\n    e.preventDefault();\n    window.history.back();\n  };\n\n  render() {\n    return (\n      <Fragment>\n        <div id=\"header\" className=\"old-history-header\">\n          <Logo showCloseSidePanelIcon={false} />\n          <CommonToolbar onSearchedClick={this.onSearchedClick} />\n        </div>\n        <div id=\"main\" onScroll={this.onScrollHandler}>\n          <div className=\"old-history-main\">\n            <Fragment>\n              <a href=\"#\" className=\"go-back\" title=\"Back\" onClick={this.goBack}>\n                <span className=\"fas fa-chevron-left\"></span>\n              </a>\n              <h2><span className=\"file-name\">{fileName}</span>{' '}{gettext('History Versions')}</h2>\n            </Fragment>\n            <Fragment>\n              <table className=\"commit-list\">\n                <thead>\n                  <tr>\n                    <th width=\"40%\" >{gettext('Time')}</th>\n                    <th width=\"30%\" >{gettext('Modifier')}</th>\n                    <th width=\"25%\" >{gettext('Size')}</th>\n                    <th width=\"5%\" ></th>\n                  </tr>\n                </thead>\n                {!this.state.isLoading &&\n                  <tbody>\n                    {this.state.historyList.map((item, index) => {\n                      return (\n                        <HistoryItem\n                          key={index}\n                          item={item}\n                          index={index}\n                          canDownload={canDownload}\n                          canCompare={canCompare}\n                          onItemRestore={this.onItemRestore}\n                        />\n                      );\n                    })}\n                  </tbody>\n                }\n              </table>\n              {(this.state.isReloadingData || this.state.isLoading) && <Loading />}\n              {this.state.nextCommit && !this.state.isLoading && !this.state.isReloadingData &&\n                <Button className=\"get-more-btn\" onClick={this.reloadMore}>{gettext('More')}</Button>\n              }\n            </Fragment>\n          </div>\n        </div>\n      </Fragment>\n    );\n  }\n}\n\nReactDom.render(<FileHistory />, document.getElementById('wrapper'));\n"],"names":["moment","window","app","config","lang","HistoryItem","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","onMouseEnter","setState","active","onMouseLeave","onItemRestore","e","preventDefault","item","state","_createClass","key","value","this","downloadUrl","URLDecorator","getUrl","type","filePath","objID","rev_file_id","userProfileURL","concat","siteRoot","encodeURIComponent","creator_email","viewUrl","historyRepoID","commit_id","Utils","encodePath","diffUrl","snapshotURL","_jsx","Fragment","children","_jsxs","className","ctime","format","index","gettext","src","creator_avatar_url","alt","href","target","rel","creator_name","bytesToSize","size","MoreMenu","canDownload","canCompare","React","_React$PureComponent","_super2","_this2","dropdownToggle","dropdownOpen","_this$props","Dropdown","isOpen","toggle","direction","DropdownToggle","tag","title","DropdownMenu","right","onClick","DropdownItem","FileHistory","listNewHistoryRecords","PER_PAGE","editUtilities","listFileHistoryRecords","then","res","data","isLoading","Error","initNewRecords","listOldHistoryRecords","repoID","seafileAPI","listOldFileHistoryRecords","initOldRecords","onScrollHandler","event","clientHeight","scrollHeight","isBottom","scrollTop","hasMore","reloadMore","isReloadingData","useNewAPI","currentPage","updateNewRecords","commitID","nextCommit","oldFilePath","updateOldRecords","commitId","path","revertFile","success","refershFileList","onSearchedClick","searchedItem","handleSearchedItemClick","goBack","history","back","historyList","undefined","result","total_count","length","oldPath","old_path","slice","page","_this3","next_start_commit","rev_renamed_old_path","_toConsumableArray","_this4","_this5","_this6","id","Logo","showCloseSidePanelIcon","CommonToolbar","onScroll","fileName","width","map","Loading","Button","ReactDom","document","getElementById"],"sourceRoot":""}