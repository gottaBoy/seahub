{"version":3,"file":"static/js/viewFileSpreadsheet.77d500a4.js","mappings":"yQAUAA,EAGIC,OAAOC,IAAIC,YAFbC,EAAMJ,EAANI,OAAQC,EAAQL,EAARK,SAAUC,EAAGN,EAAHM,IAClBC,EAAQP,EAARO,SAAUC,EAAQR,EAARQ,SAAUC,EAAQT,EAARS,SAGhBC,EAAmB,SAAAC,IAAAC,EAAAA,EAAAA,GAAAF,EAAAC,GAAA,IAAAE,GAAAC,EAAAA,EAAAA,GAAAJ,GAAA,SAAAA,IAAA,OAAAK,EAAAA,EAAAA,GAAA,KAAAL,GAAAG,EAAAG,MAAA,KAAAC,UAAA,CAKtB,OALsBC,EAAAA,EAAAA,GAAAR,EAAA,EAAAS,IAAA,SAAAC,MACvB,WACE,OACEC,EAAAA,EAAAA,KAACC,EAAAA,EAAQ,CAACC,SAASF,EAAAA,EAAAA,KAACG,EAAW,KAEnC,KAACd,CAAA,CALsB,CAASe,EAAAA,WAQ5BD,EAAW,SAAAE,IAAAd,EAAAA,EAAAA,GAAAY,EAAAE,GAAA,IAAAC,GAAAb,EAAAA,EAAAA,GAAAU,GAEf,SAAAA,EAAYI,GAAQ,IAADC,EAKf,OALed,EAAAA,EAAAA,GAAA,KAAAS,IACjBK,EAAAF,EAAAG,KAAA,KAAMF,IAqDRG,gBAAkB,SAACC,GACjB,IAAMC,EAASD,EAAEE,cACjBD,EAAOE,OAASF,EAAOG,gBAAgBC,KAAKC,YAC9C,EAvDET,EAAKU,MAAQ,CACXC,WAAYlC,EACZmC,SAAU,IACVZ,CACJ,CAyEC,OAzEAX,EAAAA,EAAAA,GAAAM,EAAA,EAAAL,IAAA,oBAAAC,MAED,WAAqB,IAADsB,EAAA,KAClB,IAAIpC,EAAJ,EAIkB,SAAdqC,IACFC,EAAAA,EAAWC,6BAA6BzC,EAAQG,EAAUF,EAAUG,EAASsC,eAAeC,MAAK,SAACC,GAEhG,OADsBA,EAAIC,KAAa,QAErC,IAAK,SACL,IAAK,aACHP,EAAKQ,SAAS,CACZV,WAAW,IAEbW,WAAWR,EAAa,KACxB,MACF,IAAK,QACHD,EAAKQ,SAAS,CACZV,WAAW,EACXC,UAAUW,EAAAA,EAAAA,IAAQ,iCAEpB,MACF,IAAK,OACHV,EAAKQ,SAAS,CACZV,WAAW,EACXC,SAAU,KAGlB,IAAGY,OAAM,SAACC,GACJA,EAAMC,SACRb,EAAKQ,SAAS,CACZV,WAAW,EACXC,UAAUW,EAAAA,EAAAA,IAAQ,iCAGpBV,EAAKQ,SAAS,CACZV,WAAW,EACXC,UAAUW,EAAAA,EAAAA,IAAQ,8BAGxB,GACF,CAEAT,EAxCA,CAyCF,GAAC,CAAAxB,IAAA,SAAAC,MAOD,WACE,IAAAoC,EAAgCC,KAAKlB,MAA7BC,EAASgB,EAAThB,UAAWC,EAAQe,EAARf,SAEnB,OAAInC,GACKe,EAAAA,EAAAA,KAACqC,EAAAA,EAAW,IAGjBlB,GACKnB,EAAAA,EAAAA,KAACsC,EAAAA,EAAO,IAGblB,GACKpB,EAAAA,EAAAA,KAACqC,EAAAA,EAAW,CAACjB,SAAUA,KAI9BpB,EAAAA,EAAAA,KAAA,OAAKuC,UAAU,iDAAgDC,UAC7DxC,EAAAA,EAAAA,KAAA,UAAQyC,GAAG,wBAAwBC,MAAOtD,EAAUuD,IAAG,GAAAC,OAAKC,EAAAA,GAAQ,0BAAAD,OAAyB7D,EAAM,KAAA6D,OAAI1D,GAAQ0D,OAAGE,mBAAmB9D,GAAS,eAAe+D,OAAQX,KAAK1B,mBAGhL,KAACP,CAAA,CAjFc,CAASC,EAAAA,WAoF1B4C,EAAAA,QAAgBhD,EAAAA,EAAAA,KAACX,EAAmB,IAAK4D,SAASC,eAAe,W","sources":["view-file-spreadsheet.js"],"sourcesContent":["import React from 'react';\nimport ReactDom from 'react-dom';\nimport { seafileAPI } from './utils/seafile-api';\nimport { siteRoot, gettext } from './utils/constants';\nimport FileView from './components/file-view/file-view';\nimport FileViewTip from './components/file-view/file-view-tip';\nimport Loading from './components/loading';\n\nimport './css/spreadsheet-file-view.css';\n\nconst {\n  repoID, filePath, err,\n  commitID, fileType, fileName\n} = window.app.pageOptions;\n\nclass ViewFileSpreadsheet extends React.Component {\n  render() {\n    return (\n      <FileView content={<FileContent />} />\n    );\n  }\n}\n\nclass FileContent extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: !err,\n      errorMsg: ''\n    };\n  }\n\n  componentDidMount() {\n    if (err) {\n      return;\n    }\n\n    let queryStatus = () => {\n      seafileAPI.queryOfficeFileConvertStatus(repoID, commitID, filePath, fileType.toLowerCase()).then((res) => {\n        const convertStatus = res.data['status'];\n        switch (convertStatus) {\n          case 'QUEUED':\n          case 'PROCESSING':\n            this.setState({\n              isLoading: true\n            });\n            setTimeout(queryStatus, 2000);\n            break;\n          case 'ERROR':\n            this.setState({\n              isLoading: false,\n              errorMsg: gettext('Document convertion failed.')\n            });\n            break;\n          case 'DONE':\n            this.setState({\n              isLoading: false,\n              errorMsg: ''\n            });\n        }\n      }).catch((error) => {\n        if (error.response) {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Document convertion failed.')\n          });\n        } else {\n          this.setState({\n            isLoading: false,\n            errorMsg: gettext('Please check the network.')\n          });\n        }\n      });\n    };\n\n    queryStatus();\n  }\n\n  setIframeHeight = (e) => {\n    const iframe = e.currentTarget;\n    iframe.height = iframe.contentDocument.body.scrollHeight;\n  };\n\n  render() {\n    const { isLoading, errorMsg } = this.state;\n\n    if (err) {\n      return <FileViewTip />;\n    }\n\n    if (isLoading) {\n      return <Loading />;\n    }\n\n    if (errorMsg) {\n      return <FileViewTip errorMsg={errorMsg} />;\n    }\n\n    return (\n      <div className=\"file-view-content flex-1 spreadsheet-file-view\">\n        <iframe id=\"spreadsheet-container\" title={fileName} src={`${siteRoot}office-convert/static/${repoID}/${commitID}${encodeURIComponent(filePath)}/index.html`} onLoad={this.setIframeHeight}></iframe>\n      </div>\n    );\n  }\n}\n\nReactDom.render(<ViewFileSpreadsheet />, document.getElementById('wrapper'));\n"],"names":["_window$app$pageOptio","window","app","pageOptions","repoID","filePath","err","commitID","fileType","fileName","ViewFileSpreadsheet","_React$Component","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","_jsx","FileView","content","FileContent","React","_React$Component2","_super2","props","_this","call","setIframeHeight","e","iframe","currentTarget","height","contentDocument","body","scrollHeight","state","isLoading","errorMsg","_this2","queryStatus","seafileAPI","queryOfficeFileConvertStatus","toLowerCase","then","res","data","setState","setTimeout","gettext","catch","error","response","_this$state","this","FileViewTip","Loading","className","children","id","title","src","concat","siteRoot","encodeURIComponent","onLoad","ReactDom","document","getElementById"],"sourceRoot":""}